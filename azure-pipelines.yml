name: $(BuildDefinitionName)_$(date:yyyyMMdd)$(rev:.r)

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: 'Prepare'
  displayName: 'Prepare'
  jobs:
  - job: 'Prepare'
    displayName: 'Prepare'
    steps:
    - script: echo $(pipeline.workspace)
      displayName: 'Run a one-line script'
    - task: TerraformInstaller@0
      inputs:
        terraformVersion: '0.12.3'
    - script: |
        terraform -version
        terraform init
        terraform plan
      workingDirectory: $(pipeline.workspace)/jjazure-terraform/src-jjaks
      failOnStderr: true
      displayName: 'Terraform plan'
      env:
        ARM_TENANT_ID: $(tenantId)
        ARM_SUBSCRIPTION_ID: $(subscriptionId)
        ARM_CLIENT_ID: $(clientId)
        ARM_CLIENT_SECRET: $(clientSecret)